# Docker volume test
## Mount a data volume without specifying volume name
Run:
```shell
$ docker run -it --name beatles -v /members centos:7
```
This command will create and run a container named “beatles”. Inside the running container a directory “/members” will be created. It will be mapped to a data volume on the host (with docker generated name).

Inspection of container gives:
Run:
```shell
$ docker inspect beatles | grep Mounts -A 11
```
```json
 "Mounts": [
            {
                "Name": "a24edb63b329d30244deafb6036488231f5dd60c8f2...7c",
                "Source": "/var/lib/docker/volumes/a24edb63b...e57c/_data",
                "Destination": "/members",
                "Driver": "local",
                "Mode": "",
                "RW": true,
                "Propagation": ""
            }
        ],
```
“Source”-directory is located on the docker host machine  
“Destination”-directory is located inside the running container

### Persistence test
1. Run/Start container 
2. Login to the container and create a file in directory "/members". Name the file john.txt and add text “John Lennon” to it.
```shell
$ docker exec -it beatles bin/bash
# echo "John Lennon" > members/john.txt
```
3. Logout and stop container
```shell
# exit
$ docker stop beatles
```
4. Start container
```shell
$ docker start beatles
```
5. Login to the container
```shell
$ docker exec -it beatles bin/bash
```
6. The directory “/members" in the container is still there as is the file “john.txt”. The host directory "/var/lib/docker/volumes/a24edb63b...e57c/_data" also is still there, and it contains the file “john.txt”.
```shell
# cat members/john.txt 
John Lennon
```
```shell
$ docker inspect beatles | grep Mounts -A 5
        "Mounts": [
            {
                "Type": "volume",
                "Name": "bb201f68a5296a2e1faad65ba8a180156b964b845c50e361d92242070f681b71",
                "Source": "/var/lib/docker/volumes/a24edb63b...e57c/_data",
                "Destination": "/members",
```


If I delete the container and again run:
```shell
$ docker run -it --name beatles -v /members centos:7
```
The directory “/member” is created in the container and is mapped to an new "unnamed" (name generated by docker) data volume on the host. 
There is no file “john.txt” in the the data volume on the host and neither in the "/member" directory in the container.   

The directory “/members” and the file “john.txt”  still exists in a “dangling” volume on the host.
```shell
$ sudo su -
# ls /var/lib/docker/volumes/a24edb63b...e57c/_data
drwxr-xr-x 2 root root 22 May 18 09:05 ./
drwxr-xr-x 3 root root 19 May 18 09:02 ../
-rw-r--r-- 1 root root 12 May 18 09:05 john.txt
```
#### Conclusion
To persist changes done to the container we can map a data volume (unnamed) on the host to a directory in the container, and changes made to that directory will persist between container stops and starts. They will no persist if the container is deleted.

***

## Mount a named data volume
The name of the volume in the example above is long and hard to recognize. 
If you instead run:
```shell
$ docker run -it --name beatles -v members:/members centos:7
```
where host-dir "members" has no leading slash (/) the volume on the host will reside amongst the other “anonymous” docker volumes, and it will have the name “members”. Quote from docker documentation:  
*“[...] Docker creates a named volume by that name”*

Inspection of container gives:
```json
"Mounts": [
    {
        "Name": "members",
        "Source": "/var/lib/docker/volumes/members/_data",
        "Destination": "/members",
        "Driver": "local",
        "Mode": "z",
        "RW": true,
        "Propagation": "rprivate"
    }
],
```
“Source”-directory is located on the docker host machine and has been given the name "members"  
“Destination”-directory is located inside the running container

### Persistence test
1. Run/Start container 
2. Login to the container and create a file in directory "/members". Name the file john.txt and add text “John Lennon” to it.
3. Stop container
4. Start container
5. Login to the container
6. The directory “/members" in the container is still there as is the file “john.txt”. The mounted host directory “/var/lib/docker/volumes/members/_data” also is still there, as is the file “john.txt”

If I delete the container and again run
```shell
$ docker run -it --name beatles -v members:/members centos:7
```
The directory “/member” with the file “john.txt” is still there, both on the host and in the container.

#### Conclusion
To persist changes done to the container we can map a named volume on the host to a directory in the container, and changes made to that directory will persist between container stops, starts and also deletions.

***

## Mount a host directory as a data volume
You can also mount a specific directory on the host to a directory in the container. To do that create a 
directory on the host called "members", and from the same level, run:
```shell
$ docker run -it --name beatles -v ${PWD}/members:/members centos:7
```
Inspection of container gives:
```json
"Mounts": [
    {
        "Source": "/usr/local/src/docker-images/beatles/members",
        "Destination": "/members",
        "Mode": "",
        "RW": true,
        "Propagation": "private"
    }
]
```
“Source”-directory is located on the docker host machine in the directory where the docker command was run  
“Destination”-directory is located inside the running container

### Persistence test
1. Run/Start container 
2. Login to the container and create a file in directory "/members". Name the file john.txt and add text “John Lennon” to it.
3. Stop container
4. Start container
5. Login to the container
6. The directory “/members" in the container is still there as is the file “john.txt”. The mounted host directory “path-on-host/members/” also is still there, as is the file “john.txt”

If I delete the container and again run (from the same directory as before)
```shell
$ docker run -it --name beatles -v ${PWD}/members:/members centos:7
```
The directory “/member” with the file “john.txt” is still there, both on the host and in the container.  

***

## Mount a host directory as a data volume when directory already exists in containers image
Quote from:  
https://docs.docker.com/engine/tutorials/dockervolumes/  
*"If the path /webapp already exists inside the container’s image, the /src/webapp mount overlays but does not remove the pre-existing content. Once the mount is removed, the content is accessible again. This is consistent with the expected behavior of the mount command."*  

### Overlay test
1. Build an image "beatles_img" from a Dockerfile that has instructions for creating a directory "/members" and adding a file "ringo.txt" with the content "Ringo Star"
2. Create/run a container named "beatles_ringo"  from image "beatles_img" and verify that "/members/ringo.txt" exists
3. Stop and delete container "beatles_ringo"
4. Create a directory "members" on the host, and create a file "john.txt" in it with the content "John Lennon"
4. From the same level, run:  
```shell
$ docker run -it --name beatles -v ${PWD}/members:/members beatles_image /bin/bash
```

When I enter the container and got to to directory "/members" only the file "john.txt" is visible. The file "ringo.txt" that came with the docker image "beatles_img" is not.
#### Conclusion
To overlay data already present in the docker conainers image, map a directory on the host with the same name.
